


Вводный курс для разработчиков и администраторов БД Алан Бьюли Изучаем SQL Learning SQL Alan Beaulieu Алан Бьюли Изучаем SQL СанктПетербург–Москва 2007 Оглавление Предисловие  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8

## Немного истории  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 Введение в базы данных. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13


Что такое SQL?  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 Что такое MySQL?. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24

Дополнительные источники . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25 2. Создание и заполнение базы данных . . . . . . . . . . . . . . . . . . . . . . . . . 27 Создание базы данных MySQL  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27

Инструмент командной строки mysql . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28 Типы данных MySQL  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30 Создание таблиц  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36

Заполнение и изменение таблиц. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42 Когда портятся хорошие выражения  . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46 Банковская схема . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49

## Азбука запросов . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51 Механика запроса . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51


Блоки запроса  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 53 Блок select  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 54

Блок from . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59 Блок where . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63

Блоки group by и having. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65 Блок order by . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 66

Упражнения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70 4. Фильтрация . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72

Оценка условия . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72 Создание условия  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75

Типы условий. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75 NULL: это слово из четырех букв…  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 86

Упражнения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 89 6 Оглавление 5. Запрос к нескольким таблицам . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90

Что такое соединение? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90 Соединение трех и более таблиц . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 97

Рекурсивные соединения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 102 Сравнение эквисоединений с неэквисоединениями . . . . . . . . . . . . . . . 103 Сравнение условий соединения и условий фильтрации. . . . . . . . . . . . 105

Упражнения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 107 6. Работа с множествами . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 108

Основы теории множеств. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 108 Теория множеств на практике  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 111 Операторы работы с множествами . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 112

Правила операций с множествами. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118 Упражнения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 121

## Создание, преобразование и работа с данными . . . . . . . . . . . . . . 122 Строковые данные. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 122 Числовые данные  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 135


Временные данные . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 140 Функции преобразования . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 151

Упражнения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 152 8. Группировка и агрегаты. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 153

Принципы группировки  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 153 Агрегатные функции . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 156

Формирование групп  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 161 Условия групповой фильтрации. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 165

Упражнения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 167 9. Подзапросы  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 168

Что такое подзапрос? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 168 Типы подзапросов . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 169

Несвязанные подзапросы. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 170 Связанные подзапросы. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 179

Использование подзапросов  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 183 Краткий обзор подзапросов. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 193

Упражнения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 194 10. И снова соединения . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 195

Внешние соединения  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 195 Перекрестные соединения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 205

Естественные соединения . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 212 Упражнения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 214

Оглавление 7 11. Условная логика . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 216 Что такое условная логика?  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 216

Выражение case. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 218 Примеры выражений case . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 221

Упражнения. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 229 12. Транзакции. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 230

Многопользовательские базы данных. . . . . . . . . . . . . . . . . . . . . . . . . . . 230 Что такое транзакция?. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 232 13. Индексы и ограничения . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 240

Индексы . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 240 Ограничения  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 251

A. ERдиаграмма примера базы данных. . . . . . . . . . . . . . . . . . . . . . . . 257 B. MySQLрасширения языка SQL  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 259 C. Решения к упражнениям . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 272

D. Дополнительные источники . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 289 Алфавитный указатель. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 301 Предисловие

Языки программирования постоянно появляются и исчезают, и очень немногие из современных языков имеют более чем 10летнюю исто рию. Среди долгожителей можно назвать КОБОЛ, который до сих пор довольно широко используется в мэйнфреймовых средах, и С, по

прежнему весьма популярный при разработке операционных систем, серверов и встроенных систем. В области баз данных это SQL, корни которого уходят в далекие 1970е. SQL – язык для формирования, манипулирования и извлечения дан

ных из реляционной БД. Одна из причин популярности реляционных БД в том, что, будучи правильно спроектированными, они могут опери ровать гигантскими объемами данных. В работе с большими наборами данных SQL напоминает современную цифровую фотокамеру с мощ

ным объективом: он позволяет просматривать большие объемы данных или перейти к «крупному плану», т. е. сфокусироваться на отдельных строках (подвластно и все, что между этими крайностями). Другие СУБД дают сбой при мощных нагрузках, потому что их фокус слишком

узок (увеличительные линзы достигают своего максимума). Именно по этой причине все попытки низвергнуть реляционные БД и SQL окан чиваются неудачей. Поэтому, даже несмотря на то, что SQL – старый язык, похоже, его ждет еще очень долгая жизнь и блестящее будущее.

Зачем изучать SQL? Если вы собираетесь работать с реляционными БД – писать приложе ния, или выполнять задачи по администрированию, или формировать отчеты, – вам понадобится знать, как взаимодействовать с данными

БД. Даже при использовании инструмента, генерирующего SQL (на пример, инструмента создания отчетов), могут возникнуть ситуации, в которых понадобится обойти автоматические возможности и созда вать собственные SQLвыражения.

Дополнительное преимущество изучения SQL в том, что вы быстрее рассмотрите и поймете структуры данных, применяемые для хране ния информации о вашей организации. Почувствовав себя уверенно со своей БД, вы сможете вносить предложения по изменению или до

полнению ее схемы. Предисловие 9 Почему именно эта книга? Язык SQL включает несколько категорий. Выражения, с помощью ко торых создаются объекты БД (таблицы, индексы, ограничения и т. д.), называют SQLвыражениями управления схемой данных (schema sta

tements). Выражения, предназначенные для создания, манипулирова ния и извлечения данных, хранящихся в БД, называют SQLвыраже ниями для работы с данными (data statements). Если вы администра тор, то будете использовать и те и другие SQLвыражения. Если вы

программист или составитель отчетов, то сможете (или вам будет позво лено) использовать только SQLвыражения для работы с данными. Хо тя в этой книге встречается много SQLвыражений управления схемой,

основное внимание в ней уделено возможностям программирования. Поскольку команд немного, SQLвыражения для работы с данными кажутся простыми. Помоему, многие из имеющихся книг по SQL только усиливают это впечатление, давая лишь поверхностный обзор

